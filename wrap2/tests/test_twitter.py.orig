

#coding: utf-8
"""Facebook wrapper tests"""

import unittest

import tweepy

import mockito

from wrap2 import twitter


class TwitterTestCase(unittest.TestCase):
    """TestCase for Twitter wrapper"""

    def tearDown(self):
        """Test cleanup routine"""
        mockito.unstub()

    def test_get_authorization_url(self):
        """test .get_authorization_url method of the Twitter wrapper."""

        tw = twitter.Twitter('token', 'secret')
        callback_url = 'http://some.com'
        test_auth_url = 'http://twitter.com/auth_url'

        auth_handler = mockito.mock()
        auth_handler.request_token = tweepy.oauth.OAuthToken.from_string('oauth_token_secret=test_secret'
                                                                         '&oauth_token=test_token')
        mockito.when(tweepy).OAuthHandler(tw.id, tw.secret, callback_url).thenReturn(auth_handler)
        mockito.when(auth_handler).get_authorization_url(signin_with_twitter=True).thenReturn(test_auth_url)

        url, opts = tw.get_authorization_url(callback_url)
        self.assertEqual(url, test_auth_url)
        self.assertEqual(opts, ('test_token', 'test_secret'))
